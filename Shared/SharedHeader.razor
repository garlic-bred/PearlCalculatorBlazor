@using PearlCalculatorBlazor.Localizer
@inject TranslateText TransText
@inject NotificationService Notice

<PageHeader>
    <TitleTemplate>
        <Flex Align="center" Gap="10" Justify="center" Wrap="wrap">
            <Image Class="hide-on-mobile" Preview="false" Height="40" src="Logo.png" alt="banner"/>
            <Title Level="1" Style="margin-bottom: 0; font-size: 20px;">Pearl Calculator Blazor</Title>
            <Tooltip Style="display: flex; justify-items: center;" Title="@TranslateText.GetTranslateText("CheckForUpdate")">
                <Button
                    Size="@AntSizeLDSType.Small"
                    Shape="@ButtonShape.Round"
                    Icon="@IconType.Outline.Sync"
                    Loading="@(_currentVersion == "Loading...")"
                    @onclick="CheckForUpdate">
                    @_currentVersion
                </Button>
            </Tooltip>
        </Flex>
    </TitleTemplate>
    <PageHeaderExtra>
        <Flex Align="center" Gap="10" Justify="center" Wrap="wrap" Style="height: 100%;">
            <Dropdown Placement="Placement.BottomRight">
                <Overlay>
                    <Menu DefaultSelectedKeys=@(new[] { "en" })>
                        <MenuItem @onclick="@(() => OnClickChangeLanguage("en"))" Key="en">@TranslateText.LanguageDict["en"]</MenuItem>
                        @foreach (var pair in TranslateText.LanguageDict)
                        {
                            if (pair.Key == "en")
                                continue;
                            <MenuItem @onclick="@(() => OnClickChangeLanguage(pair.Key))" @key=pair.Key>@pair.Value</MenuItem>
                        }
                    </Menu>
                </Overlay>
                <ChildContent>
                    <Button
                        Shape="@ButtonShape.Round"
                        Type="@ButtonType.Default"
                        Size="Large"
                        Icon="translation">
                        Language
                    </Button>
                </ChildContent>
            </Dropdown>
            <Button
                class="github-icon"
                Shape="@ButtonShape.Round"
                Type="@ButtonType.Default"
                Size="Large"
                Icon="github">
                <a href="https://github.com/whats2000/PearlCalculatorBlazor" target="_blank">
                    GitHub
                </a>
            </Button>
            <Button
                Shape="@ButtonShape.Round"
                Type="@ButtonType.Default"
                Size="Large"
                NoSpanWrap="true"
                @onclick="ToggleTheme">
                <Flex Align="center">
                    @(GetThemeIcon())
                </Flex>
            </Button>
        </Flex>
    </PageHeaderExtra>
</PageHeader>

@{
    RenderFragment ModelFooterTemplate =
        @<Template>
            <Button OnClick="@HandleCancel" @key="@("back")">
                @TranslateText.GetTranslateText("StayVersion")
            </Button>
            <Button OnClick="@HandleOk"
                    @key="@("Refresh and Update")"
                    Type="@ButtonType.Primary">
                @TranslateText.GetTranslateText("UpdateNow")
            </Button>
        </Template>;
}

<Modal Title="@TranslateText.GetTranslateText("NewVersionAvailable")"
       Visible="@_visible"
       OnOk="@HandleOk"
       OnCancel="@HandleCancel"
       Footer="@ModelFooterTemplate">
    <Title Level="4">@_modalContent</Title>
    <Paragraph>
        <ul>
            @foreach (var item in _updateNotes)
            {
                <li>@item</li>
            }
        </ul>
    </Paragraph>
</Modal>