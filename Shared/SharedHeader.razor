@using PearlCalculatorBlazor.Localizer
@inject TranslateText TransText
@inject NotificationService Notice

<PageHeader>
    <TitleTemplate>
        <Flex Align="center" Gap="10">
            <Image Preview="false" Height="40" src="Logo.png" alt="banner"/>
            <Title Level="1" Style="margin-bottom: 0; font-size: 20px;">Pearl Calculator Blazor</Title>
            <Tooltip Title="Check for updates">
                <div @onclick="@CheckForUpdate">
                    @if (_currentVersion == "Loading...")
                    {
                        <Spin/>
                    }
                    else
                    {
                        <Text>@_currentVersion</Text>
                    }
                </div>
            </Tooltip>
        </Flex>
    </TitleTemplate>
    <PageHeaderExtra>
        <Flex Wrap="true" Gap="10">
            <Dropdown Placement="Placement.BottomRight">
                <Overlay>
                    <Menu DefaultSelectedKeys=@(new[] { "en" })>
                        <MenuItem @onclick="@(() => OnClickChangeLanguage("en"))" Key="en">@TranslateText.LanguageDict["en"]</MenuItem>
                        @foreach (var pair in TranslateText.LanguageDict)
                        {
                            if (pair.Key == "en")
                                continue;
                            <MenuItem @onclick="@(() => OnClickChangeLanguage(pair.Key))" @key=pair.Key>@pair.Value</MenuItem>
                        }
                    </Menu>
                </Overlay>
                <ChildContent>
                    <Button
                        Shape="@ButtonShape.Round"
                        Type="@ButtonType.Default"
                        Size="Large"
                        Icon="translation">
                        Language
                    </Button>
                </ChildContent>
            </Dropdown>
            <Button
                class="github-icon"
                Shape="@ButtonShape.Round"
                Type="@ButtonType.Default"
                Size="Large"
                Icon="github">
                <a href="https://github.com/whats2000/PearlCalculatorBlazor" target="_blank">
                    GitHub
                </a>
            </Button>
            <Button
                Shape="@ButtonShape.Round"
                Type="@ButtonType.Default"
                Size="Large"
                NoSpanWrap="true"
                @onclick="ToggleTheme">
                <Flex Align="center">
                    @(GetThemeIcon())
                </Flex>
            </Button>
        </Flex>
    </PageHeaderExtra>
</PageHeader>

@{
    RenderFragment ModelFooterTemplate =
        @<Template>
            <Button OnClick="@HandleCancel" @key="@("back")">
                Stay in this version
            </Button>
            <Button OnClick="@HandleOk"
                    @key="@("Refresh and Update")"
                    Type="@ButtonType.Primary">
                Refresh and Update
            </Button>
        </Template>;
}

<Modal Title="New version available"
       Visible="@_visible"
       OnOk="@HandleOk"
       OnCancel="@HandleCancel"
       Footer="@ModelFooterTemplate">
    <p>@_modalContent</p>
</Modal>